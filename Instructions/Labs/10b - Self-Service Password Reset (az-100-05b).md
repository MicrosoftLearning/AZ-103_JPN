---
lab:
    title: 'Self-Service Password Reset'
    module: 'Module 10 - Securing Identtities'
---

# 演習 : セルフサービス パスワード リセット

この演習のすべての作業には、Azure ポータルを使用します。

演習用ファイル : なし

### シナリオ

Adatum Corporation は、セルフサービス パスワード リセット (SSPR) などの Azure AD Premium の 機能を利用したいと考えています。


### 目的

この演習を修了すると、次のことができるようになります。

- Azure AD のユーザーとグループを管理する。

- Azure AD に統合された SaaS アプリケーションを管理する。


### 演習 1 : Azure AD のユーザーとグループを管理する

この演習の主な作業は次のとおりです。

1. 新しい Azure AD テナントを作成する。

1. Azure AD Premium v2 試用版をアクティブにする。

1. Azure AD ユーザーを作成して構成する。

1. Azure AD ユーザーに Azure AD Premium v2 のライセンスを割り当てる。

1. Azure AD グループのメンバーシップを管理する。 

1. SSPR 機能を設定する。

1. SSPR 機能を検証する。


#### 作業 1: 新しい Azure AD テナントを作成する

1. 演習用の仮想マシンで、Microsoft Edge を起動します。[**http://portal.azure.com**](http://portal.azure.com) から Azure ポータル にアクセスします。演習用の Azure サブスクリプションの所有者ロールをもつ Microsoft アカウントでサインインします。

1. Azure ポータルから [**リソースの作成**] ブレードを開きます。

1. [**リソースの作成**] ブレードの、Azure Marketplace の検索ボックスに「**Azure Active Directory**」と入力します。

1. 検索結果から、[Azure Active Directory] ブレードを開き [**作成**] をクリックします。

1. [**ディレクトリの作成**] ブレードで、次のような設定の Azure AD テナントを作成します。

- 組織名 : **AdatumLab100-5b**

- 初期ドメイン名 : 文字と数字の組み合わせで構成される一意の名前

- 国/リージョン : **米国**

   > **注** : 初期ドメイン名は控えておいてください。この演習の後半で使用します。


#### 作業 2 : Azure AD Premium v2 試用版をアクティブにする

1. 新規作成した Azure AD テナントに "**ディレクトリ + サブスクリプション**" フィルターを設定します。

   > **注** : [**ディレクトリ + サブスクリプション**] フィルターは、Azure ポータルのツール バーの通知アイコンの左にあります。

   > **注** : [**ディレクトリ + サブスクリプション**] に "**AdatumLab100-5b**" エントリがない場合は、ページを更新します。

1. Azure ポータルから、[Azure Active Directory] ブレードを開き、[**AdatumLab100-5b - 概要**] ブレードを表示します。

1. AdatumLab100-5b の[**概要**] ブレードから、[**ライセンス**] ブレードに移動します。

1. [**ライセンス - 概要**] ブレードから、[**すべての製品**] ブレードに移動します。

1. [**ライセンス - すべての製品**] ブレードで、[+ 試用/購入] をクリックして、[**Activate**] ブレードを開きます。そして、"**Azure AD PREMIUM P2**" の [無料試用版] を開き、[アクティブ化] をクリックします。


#### 作業 3 : Azure AD ユーザーを作成して構成する

1. Azure ポータルから、Azure AD テナント "AdatumLab100-5b" の [**ユーザー - すべてのユーザー**] ブレードを開きます。

1. [**ユーザー - すべてのユーザー**] ブレードで、[+ 新しいユーザー] をクリックし、次のような設定で新しいユーザーを作成します。

   - 名前 : **aaduser1**

   - ユーザー名 : **aaduser1@&lt;DNS-domain-name&gt;.onmicrosoft.com** (&lt;DNS-domain-name&gt; には作業 1 で指定した、初期ドメイン名が入ります。)
   > **注** : このユーザー名を控えておいてください。この演習の後半で使用します。

   - パスワード : [**パスワードを表示**] のボックスにチェックを入て [**初期パスワード**] に表示される文字列を控えておきます。この演習の後半で使用します。

   - グループ : **0 個のグループが選択されました**

   - 役割 : **ユーザー**

   - 部署 : **Sales**




1. [**ユーザー - すべてのユーザー**] ブレードで、[+ 新しいユーザー] をクリックし、次のような設定で新しいユーザーを作成します。

   - 名前 : **aaduser2**

   - ユーザー名 : **aaduser2@&lt;DNS-domain-name&gt;.onmicrosoft.com** (&lt;DNS-domain-name&gt; には作業 1 で指定した、初期ドメイン名が入ります。)
   > **注** : このユーザー名を控えておいてください。この演習の後半で使用します。

   - パスワード : [**パスワードを表示**] のボックスにチェックを入て [**初期パスワード**] に表示される文字列を控えておきます。この演習の後半で使用します。

   - グループ : **0 個のグループが選択されました**

   - 役割 : **ユーザー**

   - 部署: **Finance**



#### 作業 4 : Azure AD ユーザーに Azure AD Premium v2 のライセンスを割り当てる

> **注** : Azure AD ユーザーに Azure AD Premium v2 のライセンスを割り当てるためには、まずユーザーの場所属性を設定する必要があります。

1. [**ユーザー - すべてのユーザー**] ブレードから [aaduser1] をクリックして、[**aaduser1 - プロファイル**] ブレードを表示します。[設定] の [編集] をクリックして、[**利用場所**] を [**米国**] に設定し、[保存] をクリックします。

1. [aaduser1] の [**プロファイル**] ブレードから、[**ライセンス**] ブレードに移動します。[+ 割り当て] をクリックして、[製品] から "Azure Active Directory Premium P2" ライセンスを選択し、[保存] をクリックします。

1. [**ユーザー - すべてのユーザー**] ブレードに戻り、[**aaduser2 - プロファイル**] ブレードで、同じように [**利用場所**] を [**米国**] に設定します。

1. [aaduser2] の [**プロファイル**] ブレードから、[**ライセンス**] ブレードに移動します。[+ 割り当て] をクリックして、[製品] から "Azure Active Directory Premium P2" ライセンスを選択し、[保存] をクリックします。

1. [**ユーザー - すべてのユーザー**] ブレードで、演習用に使用しているユーザー アカウントをクリックし、プロファイルを表示します。同様に [**利用場所**] を [**米国**] に設定します。

1. ユーザー アカウントの [**ライセンス**] ブレードに移動します。[+ 割り当て] をクリックして、[製品] から "Azure Active Directory Premium P2" ライセンスを選択し、[保存] をクリックします。

1. 一度ポータルからサインアウトして、演習で使用しているアカウントで再度サインインします。

   > **注** : この手順は、ライセンス割り当てを有効にするために必須です。


#### 作業 5 : Azure AD グループのメンバーシップを管理する

1. Azure ポータルから [Azure Active Directory] を開き、AdatumLab100-5b の [**グループ**] ブレードを開きます。

1. [**グループ - すべてのグループ**] で、[**+ 新しいグループ**] をクリックし、次のような設定のグループを作成します。

   - グループの種類 : **セキュリティ**

   - グループ名 : **Sales**

   - グループの説明 : **All users in the Sales department**

   - メンバーシップの種類 : **動的ユーザー**

   - 動的なユーザー メンバー :

      - 1 つの式を構成

      - **(user.department -eq "Sales")** というルールを構成するため、[プロパティ] を "department" とし、[演算子] を "Equals"、[値] を "Sales" とします。

1. [**グループ - すべてのグループ**] で、[**+ 新しいグループ**] をクリックし、次のような設定のグループを作成します。

   - グループの種類 : **セキュリティ**

   - グループ名 : **Sales and Finance**

   - グループの説明 : **All users in the Sales and Finance departments**

   - メンバーシップの種類 : **動的ユーザー**

   - 動的なユーザー メンバー :

      - **(user.department -eq "Sales") -or (user.department -eq "Finance")** 2 つの式を構成します。[プロパティ] を "department" とし、[演算子] を "Equals"、[値] を "Sales" とします。次に、[+ 式の追加] をクリックして、"または" を選択し、[プロパティ] を "department"、[演算子] を "Equals"、[値] を "Finance" とします。

1. [**グループ - すべてのグループ**] ブレードで、[**Sales**] グループと、[**Sales and Finance**] グループを確認すると、メンバーシップの処理の状態が"Evaluating" であることが確認できます。処理が完了するのを待って、各グループの [**メンバー**] ブレードを確認し、グループのメンバーを確かめます。


#### 作業 6 : SSPR 機能を設定する

1. Azure ポータルから、[Azure Active Directory] ブレードを開き、[**AdatumLab100-5b - 概要**] ブレードを表示します。

1. AdatumLab100-5b の[**概要**] ブレードから、[**パスワード リセット**] に移動します。

1. [**パスワード リセット - プロパティ**] ブレードで、次のように設定します。

   - パスワード リセットのセルフサービスが有効 : **選択済み**

   - グループの選択 : **Sales**

1. [**パスワード リセット - プロパテ**] ブレードから、[**パスワード リセット - 認証方法**] ブレードに移動し、次のように設定します。

   - リセットのために必要な方法の数 : **1**

   - ユーザーが使用できる方法 :

      - **電子メール**

      - **携帯電話 (SMSのみ)**

      - **会社電話**

      - **秘密の質問**

      - 登録する必要がある質問の数 : **3**

      - リセットに必要な質問の数 : **3**

      - 秘密の質問の選択 : [**+ 定義済み**] を選択し、5 つ選択します。

1. [**パスワード リセット - 認証方法**] ブレードから、[**パスワード リセット - 登録**] ブレードに移動し、次のように設定します。

   - サインイン時にユーザーに登録を求めますか? : **はい**

   - ユーザーが認証情報を再確認するように求められるまでの日数 : **180**


#### 作業 7 : SSPR 機能を検証する

1. Microsoft Edge で InPrivate ウィンドウを開きます。

1. InPrivate ウィンドウで、**aaduser1** のアカウントで Azure ポータルにサインインします。プロンプトが表示された場合は、パスワードを新しく設定してください。

   > **注** : 前述したとおり、Azure AD テナント **aaduser1** ユーザー アカウントの DNS ユーザー名を含む、アカウントの正式なユーザー名を入力する必要があります。

1. "**詳細情報が必要**"というメッセージが表示された場合は、[次へ] をクリックして、[**引き続きアカウントにアクセスできるようにする**] ページに進みます。

1. [**引き続きアカウントにアクセスできるようにする**] ページで、認証方法について "少なくとも 1 個のオプションを選択する必要がある" と表示されています。

   - **会社電話**

   - **認証用電話**

   - **認証用電子メール**

   - **セキュリティの質問**

1. [**引き続きアカウントにアクセスできるようにする**] ページで、前の作業で設定した 5 つの秘密の質問に回答します。

1. Azure ポータルにサインインできたことを確認します。

1. **aaduser1** ユーザーとしてサインアウトして、InPrivateウィンドウを閉じます。

1. Microsoft Edge で InPrivate ウィンドウを開きます。

1. ブラウザで、Azure ポータルを開き、**サインイン** ページから **aaduser1** としてサインインします。

1. [**パスワードの入力**] ページで、[**パスワードを忘れた場合**] リンクをクリックします。

1. [**アカウントを回復する**] ページで、[**ユーザー ID**]を確認し、画像の文字またはオーディオの単語を入力し、次に進みます。

1. 次のページで、前の作業で設定した 5 つの質問から選ばれた 3 つのセキュリティの質問に回答します。

1. 次に、新しいパスワードを設定し 2 回入力すると、パスワード リセットの処理は完了です。

1. この新しいパスワードで、Azure ポータルにサインインできるか確認します。

> **結果** : この演習では、新しい Azure AD テナントを作成し、Azure AD Premium v2 試用版をアクティブ化し、Azure AD ユーザーを作成および構成し、Azure AD Premium v2 ライセンスを Azure AD ユーザーに割り当て、Azure AD グループ メンバーシップを管理しました。また、SSPR 機能を設定し、検証しました。


### 演習 2 : Azure AD に統合された SaaS アプリケーションを管理する

この演習の主な作業は次のとおりです。

1. Azure AD ギャラリーからアプリケーションを追加する。

1. シングル サインオン用にアプリケーションを設定する。

1. アプリケーションにユーザーを割り当てる。

1. アプリケーションのシングル サインオンを検証する。


#### 作業 1 : Azure AD ギャラリーからアプリケーションを追加する

1. Azure ポータルから、[Azure Active Directory] ブレードを開き、[**AdatumLab100-5b - 概要**] ブレードを表示します。

1. [**AdatumLab100-5b - 概要**] ブレードから、[**エンタープライズ アプリケーション**] ブレードを開きます。

1. [**エンタープライズ アプリケーション - すべてのアプリケーション**] ブレードで、[**+ 新しいアプリケーション**] をクリックします。

1. [**アプリケーションの追加**] ブレードで、ギャラリーから「**Microsoft OneDrive**」を検索します。

1. 検索リストから [**Microsoft OneDrive**] を選択し、[追加] をクリックしてアプリを選択します。


#### 作業 2 : シングル サインオン用にアプリケーションを設定する

1. [**Microsoft OneDrive - 概要**] ブレードから、[**Microsoft OneDrive - はじめに**] ブレードに移動します。

1. [**Microsoft OneDrive - はじめに**] ブレードで、[**シングル サインオンを構成する (必須)**] オプションを選択し、[**Microsoft OneDrive - シングル サインオン**] ブレードを開きます。

1. [**Microsoft OneDrive - シングル サインオン**] ブレードで、[**パスワードベース**] オプションを選択し、保存します。


#### 作業 3 : アプリケーションにユーザーを割り当てる

1. 再度、[**Microsoft OneDrive - はじめに**] ブレードに戻ります。

1. [**Microsoft OneDrive - はじめに**] ブレードで、[**テスト用のユーザーを割り当てる (必須)**] オプションを選択し、**Microsoft OneDrive** の [**ユーザーとグループ**] ブレードを開きます。

1. **Microsoft OneDrive** の **ユーザーとグループ** で、[**+ ユーザーの追加**] をクリックし、次のように割り当てます。

   - ユーザーとグループ : **Sales and Finance**

   - ロールの選択 : **Default access**

   - 資格情報の割り当て :

      - すべてのグループ メンバー間で共有する資格情報を割り当てますか? : **はい**

      - 電子メール アドレス : この演習で使用している Microsoft アカウントのアドレス

      - パスワード : この演習で使用している Microsoft アカウントのパスワード

1. Azure ポータルからサインアウトして、Microsoft Edge も閉じます。


#### 作業 4 : アプリケーションのシングル サインオンを検証する

1. Microsoft Edge を起動します。

1. Microsoft Edge ウィンドウで、[**http://myapps.microsoft.com**](http://myapps.microsoft.com) から Application Access Panel を開き、**aaduser2** のユーザー アカウントでサインインします。プロンプトが表示された場合は、パスワードを新しく設定してください。

   > **注** : 演習の前半で設定した **aaduser2** ユーザー アカウントの DNS ユーザー名を含む、アカウントの正式なユーザー名を入力する必要があります。

1. アクセス パネル アプリケーション ページで、**Microsoft OneDrive** アイコンをクリックします。

1. "My Apps Secure Sign-in Extension" を追加するようにプロンプトが表示された場合は、追加して [**InPrivate ブラウズを許可する**] オプションを含め、有効にします。

1. [**http://myapps.microsoft.com**](http://myapps.microsoft.com) から、アクセス パネル アプリケーション ページを開き、**aaduser2** ユーザーとしてサインインします。

1. アクセス パネル アプリケーション ページで、**Microsoft OneDrive** アイコンをクリックします。

1. Microsoft OneDrive アプリケーションに、再認証せずにアクセスできたことを確認します。

1. アクセス パネル アプリケーションからサインアウトし、Microsoft Edge ウィンドウを閉じます。

   > **注**: Microsoft Edge を再度起動し、この演習で使用している Azure サブスクリプションの所有者ロールのある Microsoft アカウントでサインインして、[**ディレクトリ + サブスクリプション**] フィルターを、既定の Azure AD テナントに戻し、演習を完了します。

> **結果**: この演習では、Azure AD ギャラリーからアプリケーションを追加し、シングル サインオン用にアプリケーションを構成し、アプリケーションにユーザーを割り当て、アプリケーションのシングル サインオンを検証しました。
